C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 1   


C51 COMPILER V8.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\keil3\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********************ÑÇ²©ÖÇÄÜÐ¡³µÀý³Ì************************
   2          *  Æ½Ì¨£ºBST-V51  + Keil uVision3 + STC89C52 
   3          *  Ãû³Æ£ºÖÇÄÜÐ¡³µÀý³Ì
   4          *  ¹«Ë¾£ºÉîÛÚÊÐÑÇ²©Èí¼þ¿ª·¢ÓÐÏÞ¹«Ë¾
   5          *  ÌÔ±¦£ºhttp://bstmcu.taobao.com       
   6          *  ±àÐ´£ºÂÞ¹¤
   7          *  ÈÕÆÚ£º2014-9-11
   8          *  ¾§Õñ:11.0592MHZ
   9          *  ËµÃ÷£ºÃâ·Ñ¿ªÔ´£¬²»Ìá¹©Ô´´úÂë·ÖÎö£¬ÓÐÎÊÌâÖ±½Óµ½½»Á÷Èº½»Á÷
  10          *  QQ½»Á÷Èº£º217588580 
  11          *  Ó²¼þÉèÖÃ£ºÒªÓÐ×Ô¼º¶¯ÊÖÄÜÁ¦£¬½øÐÐ×é×°½ÓÏßºÍ´«¸ÐÆ÷ÁéÃô¶ÈµÄµ÷ÊÔ£¬²ÅÄÜÍê³ÉÊµÑé
  12          *  Ê¹ÓÃËµÃ÷£º¸ù¾ÝÏÂÃæIO¿Ú×Ô¼ºÓÃ¶Å°îÏßÁ¬½Ó¸÷ÖÖÄ£¿é£¬¿ÉÒÔ×Ô¼ºÐÞ¸Ä¸÷ÖÖÄ£¿éIO¿Ú
  13          
  14          *  ±¾ÊµÑéÐèÒªÊ¹ÓÃLCD1602Òº¾§ÆÁ ×¢Òâµ÷½Ú¿ª·¢°åÉÏSW1¶Ô±È¶È£¬ÓÃµçÄÔUSB¹©µçÊ±µ÷´óÒ»µã£¬ÓÃµç³Ø¹©µçÊ±µ÷Ð¡Ò»µã¶Ô±
             -È¶È¡£
  15          
  16          *  Ñ§Ï°½¨Òé£º½øÐÐÖÇÄÜÐ¡³µ³ÌÐòÑ§Ï°Ç°£¬¿ÉÏÈ¿´51µ¥Æ¬»ú¿ª·¢°åÅäÌ×28¿ÎÊÓÆµ½Ì³Ì
  17           
  18          ******************************************************************/
  19           //ÉÏµçºó°´ÏÂK4¼ü³ÌÐòÔËÐÐ£¬Ð¡³µ½øÐÐ³¬Éù²¨±ÜÕÏÅÜ
  20           //LCD1602Òº¾§ÆÁÉÏÏÔÊ¾Ì½²âµ½µÄÊµÊ±¾àÀë
  21          
  22          /**************************************************************
  23          //ÖØÒªËµÃ÷£ºÃ»ÓÐLCD1602Òº¾§ÏÔÊ¾ÆÁµÄÍ¬Ñ§£¬ÐèÒªÓÃ¶Å°îÏß½«P0.7½ÓµØ³ÌÐò²ÅÄÜÕý³£ÔËÐÐ
  24          ****************************************************************/
  25          
  26          //×¢Òâ³ÌÐòÖ»×ö²Î¿¼Ö®ÓÃ£¬Òª´ïµ½×îÀíÏëµÄ±ÜÕÏÐ§¹û£¬»¹ÐèÒªÍ¬Ñ§ÃÇÏ¸ÐÄµ÷ÊÔ¡£
  27          
  28          #include <reg52.h>         //52Ð¾Æ¬ÅäÖÃÎÄ¼þ
  29          #include <intrins.h>   //°üº¬nopµÈÏµÍ³º¯Êý
  30          #include "bst_car.h"   //°üº¬bst¡ªv51ÖÇÄÜÐ¡³µÍ·ÎÄ¼þ
  31          
  32          #define LCM_Data  P0   //¶¨ÒåÒº¾§ÆÁÊý¾Ý¿Ú
  33          #define Busy    0x80   //ÓÃÓÚ¼ì²âLCM×´Ì¬×ÖÖÐµÄBusy±êÊ¶
  34          
  35          sbit DU = P2^6;            //ÊýÂë¹Ü¶ÎÑ¡
  36          sbit WE = P2^7;            //ÊýÂë¹ÜÎ»Ñ¡
  37          
  38          
  39          sbit pwm = P2^7;//Êä³öPWMÐÅºÅ
  40          unsigned char count=0;
  41          unsigned char SEH_count = 10;  //³¯ÏòÇ°Ãæ
  42          
  43          int LeftDistance = 0, RightDistance = 0;
  44          unsigned long ultrasonic[5] = {0};
  45          
  46          unsigned char hongwai = 0; //ÓÐºìÍâ¼à²âÔòÍ£Ö¹Ç°½ø±êÖ¾Î»
  47          
  48          sbit LCM_RW=P1^1 ;     //¶¨ÒåLCDÒý½Å
  49          sbit LCM_RS=P1^0 ;
  50          sbit LCM_E=P2^5  ;
  51          
  52          unsigned char code Range[] ="==Range Finder==";//LCD1602ÏÔÊ¾¸ñÊ½
  53          unsigned char code ASCII[13] = "0123456789.-M";
  54          unsigned char code table[]="Distance:000.0cm";
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 2   

  55          unsigned char code table1[]="!!! Out of range";
  56          
  57          unsigned char disbuff[4]={0,0,0,0};//ÓÃÓÚ·Ö±ð´æ·Å¾àÀëµÄÖµ0.1mm¡¢mm¡¢cmºÍmµÄÖµ
  58          
  59          unsigned int  time=0;//ÓÃÓÚ´æ·Å¶¨Ê±Æ÷Ê±¼äÖµ
  60          unsigned long S = 0;//ÓÃÓÚ´æ·Å¾àÀëµÄÖµ
  61          bit  flag =0; //Á¿³ÌÒç³ö±êÖ¾Î»
  62          char a=0;
  63          
  64          
  65          unsigned char pwm_val_left  =0;//±äÁ¿¶¨Òå
  66          unsigned char pwm_val_right =0;
  67          unsigned char push_val_left =10;// ×óµç»úÕ¼¿Õ±ÈN/20 //ËÙ¶Èµ÷½Ú±äÁ¿ 0-20¡£¡£¡£0×îÐ¡£¬20×î´ó
  68          unsigned char push_val_right=10;// ÓÒµç»úÕ¼¿Õ±ÈN/20 
  69          unsigned char pwmcount = 0;
  70          //========================================================================================================
             -=================
  71          void delay(unsigned int xms)                            
  72          {
  73   1          unsigned int i,j;
  74   1              for(i=xms;i>0;i--)                    //i=xms¼´ÑÓÊ±Ô¼xmsºÁÃë
  75   1          for(j=112;j>0;j--);
  76   1      }
  77          
  78          void Delay10us(unsigned int i)          //10usÑÓÊ±º¯Êý Æô¶¯³¬Éù²¨Ä£¿éÊ±Ê¹ÓÃ
  79          { 
  80   1              unsigned int j; 
  81   1              do
  82   1              { 
  83   2                      j = 10; 
  84   2                      do
  85   2                      { 
  86   3                              _nop_(); 
  87   3                      }
  88   2                      while(--j); 
  89   2              }
  90   1              while(--i); 
  91   1      }  
  92          
  93          void cmg88()//¹ØÊýÂë¹Ü
  94          {
  95   1          DU=1;  
  96   1          P0=0X00;
  97   1          DU=0;
  98   1      }
  99          /************************************LCD1602Òº¾§ÆÁÇý¶¯º¯Êý************************************************
             -/
 100          //*******************¶Á×´Ì¬*************************//
 101          unsigned char ReadStatusLCM(void)
 102          {
 103   1              LCM_Data = 0xFF; 
 104   1              LCM_RS = 0;
 105   1              Delay10us(1); 
 106   1              LCM_RW = 1;
 107   1              Delay10us(1); 
 108   1              do{
 109   2                      LCM_E = 0;
 110   2                      Delay10us(1); 
 111   2                      LCM_E = 0;
 112   2                      Delay10us(1); 
 113   2                      LCM_E = 1;
 114   2                      Delay10us(1); 
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 3   

 115   2              }
 116   1              while (LCM_Data & Busy); //¼ì²âÃ¦ÐÅºÅ
 117   1              return(LCM_Data);
 118   1      }
 119          
 120          /****************Ð´Êý¾Ý************************/
 121          void WriteDataLCM(unsigned char WDLCM) 
 122          {
 123   1              ReadStatusLCM(); //¼ì²âÃ¦
 124   1              LCM_Data = WDLCM;
 125   1              LCM_RS = 1;
 126   1              Delay10us(1); 
 127   1              LCM_RW = 0;
 128   1              Delay10us(1); 
 129   1              LCM_E = 0; //Èô¾§ÕñËÙ¶ÈÌ«¸ß¿ÉÒÔÔÚÕâºó¼ÓÐ¡µÄÑÓÊ±
 130   1              Delay10us(1); 
 131   1              LCM_E = 0; //ÑÓÊ±
 132   1              Delay10us(1); 
 133   1              LCM_E = 1;
 134   1              Delay10us(1); 
 135   1      }
 136          
 137          //****************Ð´Ö¸Áî*************************//
 138          void WriteCommandLCM(unsigned char WCLCM,BuysC) //BuysCÎª0Ê±ºöÂÔÃ¦¼ì²â
 139          {
 140   1              if (BuysC) ReadStatusLCM(); //¸ù¾ÝÐèÒª¼ì²âÃ¦
 141   1              LCM_Data = WCLCM;
 142   1              LCM_RS = 0;
 143   1              Delay10us(1); 
 144   1              LCM_RW = 0;     
 145   1              Delay10us(1); 
 146   1              LCM_E = 0;
 147   1              Delay10us(1); 
 148   1              LCM_E = 0;
 149   1              Delay10us(1); 
 150   1              LCM_E = 1;
 151   1              Delay10us(1); 
 152   1      }
 153          
 154          
 155          
 156          //*******************LCM³õÊ¼»¯**********************//
 157          void LCMInit(void) 
 158          {
 159   1              LCM_Data = 0;
 160   1              WriteCommandLCM(0x38,0); //Èý´ÎÏÔÊ¾Ä£Ê½ÉèÖÃ£¬²»¼ì²âÃ¦ÐÅºÅ
 161   1              delay(5); 
 162   1              WriteCommandLCM(0x38,0);
 163   1              delay(5); 
 164   1              WriteCommandLCM(0x38,0);
 165   1              delay(5); 
 166   1      
 167   1              WriteCommandLCM(0x38,1); //ÏÔÊ¾Ä£Ê½ÉèÖÃ,¿ªÊ¼ÒªÇóÃ¿´Î¼ì²âÃ¦ÐÅºÅ
 168   1              WriteCommandLCM(0x08,1); //¹Ø±ÕÏÔÊ¾
 169   1              WriteCommandLCM(0x01,1); //ÏÔÊ¾ÇåÆÁ
 170   1              WriteCommandLCM(0x06,1); // ÏÔÊ¾¹â±êÒÆ¶¯ÉèÖÃ
 171   1              WriteCommandLCM(0x0c,1); // ÏÔÊ¾¿ª¼°¹â±êÉèÖÃ
 172   1      }
 173          
 174          //*********************°´Ö¸¶¨Î»ÖÃÏÔÊ¾Ò»¸ö×Ö·û***********************//
 175          void DisplayOneChar(unsigned char X, unsigned char Y, unsigned char DData)
 176          {
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 4   

 177   1              Y &= 0x1;
 178   1              X &= 0xF; //ÏÞÖÆX²»ÄÜ´óÓÚ15£¬Y²»ÄÜ´óÓÚ1
 179   1              if (Y) X |= 0x40; //µ±ÒªÏÔÊ¾µÚ¶þÐÐÊ±µØÖ·Âë+0x40;
 180   1              X |= 0x80; //Ëã³öÖ¸ÁîÂë
 181   1              WriteCommandLCM(X, 1); //·¢ÃüÁî×Ö
 182   1              WriteDataLCM(DData); //·¢Êý¾Ý
 183   1      }
 184          
 185          //**********************°´Ö¸¶¨Î»ÖÃÏÔÊ¾Ò»´®×Ö·û*************************//
 186          void DisplayListChar(unsigned char X, unsigned char Y, unsigned char code *DData)
 187          {
 188   1              unsigned char ListLength;
 189   1      
 190   1              ListLength = 0;
 191   1              Y &= 0x1;
 192   1              X &= 0xF; //ÏÞÖÆX²»ÄÜ´óÓÚ15£¬Y²»ÄÜ´óÓÚ1
 193   1              while (DData[ListLength]>0x19) //Èôµ½´ï×Ö´®Î²ÔòÍË³ö
 194   1              {
 195   2                      if (X <= 0xF) //X×ø±êÓ¦Ð¡ÓÚ0xF
 196   2                      {
 197   3                              DisplayOneChar(X, Y, DData[ListLength]); //ÏÔÊ¾µ¥¸ö×Ö·û
 198   3                              ListLength++;
 199   3                              X++;
 200   3                      }
 201   2              }
 202   1      }
 203          
 204          
 205          /***************************************************************************/
 206          
 207          
 208          void  StartModule()                      //Æô¶¯³¬Éù²¨Ä£¿é
 209          {
 210   1                TX=1;                                      //Æô¶¯Ò»´ÎÄ£¿é
 211   1            Delay10us(2);
 212   1                TX=0;
 213   1      }
 214          
 215           void Forward(int ms)//Ç°½ø
 216          {
 217   1               IN2=1;
 218   1               IN3=1;
 219   1      
 220   1               IN1=0;
 221   1               IN4=0;
 222   1               delay(ms);
 223   1      }
 224          
 225          void Stop(int ms)       //Í£³µ
 226          {
 227   1      
 228   1               IN1=0; 
 229   1               IN2=0;
 230   1               IN3=0;
 231   1               IN4=0;
 232   1               delay(ms);
 233   1      }
 234          
 235          void back(int ms)       //ºóÍË
 236          {
 237   1      
 238   1               IN1=1; 
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 5   

 239   1               IN2=0;
 240   1               IN3=0;
 241   1               IN4=1;
 242   1               delay(ms);
 243   1      }    
 244          void Turn_Right(int ms)  //ÏòÓÒÐý×ª
 245          {
 246   1          
 247   1              IN2=1;
 248   1              IN3=0;
 249   1      
 250   1              IN1=0; 
 251   1              IN4=1;
 252   1              delay(ms);
 253   1      }
 254          void Turn_Left(int ms)   //ÏòÓÒÐý×ª
 255          {
 256   1              IN2=0;
 257   1              IN3=1;
 258   1      
 259   1              IN1=1;
 260   1              IN4=0;
 261   1              delay(ms);
 262   1      }
 263          //========================================================================================================
             -=================
 264          /********¾àÀë¼ÆËã³ÌÐò***************/
 265          unsigned long conut1(void)
 266          {
 267   1              unsigned long dis = 0;
 268   1              time=TH1*256+TL1;
 269   1              TH1=0;
 270   1              TL1=0;
 271   1              
 272   1         //´ËÊ±timeµÄÊ±¼äµ¥Î»¾ö¶¨ÓÚ¾§ÕñµÄÆµÂÊ£¬Íâ½Ó¾§ÕñÎª11.0592MHZ
 273   1         //ÄÇÃ´1usÉù²¨ÄÜ×ß¶àÔ¶µÄ¾àÀëÄØ£¿1s=1000ms=1000000us 
 274   1         // 340/1000000=0.00034Ã×
 275   1         //0.00034Ã×/1000=0.34ºÁÃ×  Ò²¾ÍÊÇ1usÄÜ×ß0.34ºÁÃ×
 276   1         //µ«ÊÇ£¬ÎÒÃÇÏÖÔÚ¼ÆËãµÄÊÇ´Ó³¬Éù²¨·¢Éäµ½·´Éä½ÓÊÕµÄË«Â·³Ì£¬
 277   1         //ËùÒÔÎÒÃÇ½«¼ÆËãµÄ½á¹û³ýÒÔ2²ÅÊÇÊµ¼ÊµÄÂ·³Ì
 278   1          dis=time*0.17+10;//´ËÊ±¼ÆËãµ½µÄ½á¹ûÎªºÁÃ×£¬²¢ÇÒÊÇ¾«È·µ½ºÁÃ×µÄºóÁ½Î»ÁË£¬ÓÐÁ½¸öÐ¡Êýµã 
 279   1              return dis;
 280   1      }
 281          
 282          //Ã°ÅÝÅÅÐò
 283          void bubble(unsigned long *a, int n) /*¶¨ÒåÁ½¸ö²ÎÊý£ºÊý×éÊ×µØÖ·ÓëÊý×é´óÐ¡*/
 284          
 285          {
 286   1              int i,j,temp;   
 287   1              for(i = 0;i < n-1; i++) 
 288   1              {       
 289   2                      for(j = i + 1; j < n; j++) /*×¢ÒâÑ­»·µÄÉÏÏÂÏÞ*/
 290   2                      {
 291   3                              if(a[i] > a[j])
 292   3                              {
 293   4                                      temp = a[i];            
 294   4                                      a[i] = a[j];            
 295   4                                      a[j] = temp;                    
 296   4                              }
 297   3                      }
 298   2              }
 299   1      
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 6   

 300   1      }
 301          unsigned long Distance(void)
 302          {
 303   1              int num = 0;
 304   1              unsigned long Distance = 0;
 305   1              RX = 1;
 306   1              StartModule();                          
 307   1          while(RX==0);    
 308   1              
 309   1      
 310   1              TR1=1;                      //¿ªÆô¼ÆÊý
 311   1          while(RX);                  //µ±RXÎª1¼ÆÊý²¢µÈ´ý
 312   1          TR1=0;                              //¹Ø±Õ¼ÆÊý
 313   1          
 314   1              conut1();
 315   1      
 316   1              while(num < 5) // ²â5´ÎÊý¾Ý
 317   1              {
 318   2                      RX = 1;
 319   2                      StartModule();                          
 320   2                  while(RX==0);    
 321   2              
 322   2                      TR1=1;                      //¿ªÆô¼ÆÊý
 323   2                  while(RX);                  //µ±RXÎª1¼ÆÊý²¢µÈ´ý
 324   2                  TR1=0;                              //¹Ø±Õ¼ÆÊý
 325   2                  
 326   2                      S = conut1();
 327   2                      ultrasonic[num] = S;
 328   2                      num++;
 329   2              }
 330   1              num = 0;
 331   1              bubble(ultrasonic, 5);
 332   1              Distance = (ultrasonic[1]+ultrasonic[2]+ultrasonic[3])/3; //È¥µô×î´óºÍ×îÐ¡È¡ÖÐ¼äÆ½¾ùÖµ   
 333   1              return Distance;
 334   1      }
 335          
 336          void DisplayLCD1602(unsigned long v_s)
 337          {
 338   1              if((v_s>=5000)||flag==1) //³¬³ö²âÁ¿·¶Î§
 339   1              {
 340   2                  flag=0;
 341   2              DisplayListChar(0, 1, table1);
 342   2              }
 343   1              else
 344   1              {
 345   2              disbuff[0]=v_s%10;
 346   2                  disbuff[1]=v_s/10%10;
 347   2                  disbuff[2]=v_s/100%10;
 348   2                  disbuff[3]=v_s/1000;
 349   2                  DisplayListChar(0, 1, table);
 350   2                  DisplayOneChar(9, 1, ASCII[disbuff[3]]);
 351   2                  DisplayOneChar(10, 1, ASCII[disbuff[2]]);   
 352   2                  DisplayOneChar(11, 1, ASCII[disbuff[1]]);
 353   2              DisplayOneChar(12, 1, ASCII[10]);
 354   2                  DisplayOneChar(13, 1, ASCII[disbuff[0]]);
 355   2               }
 356   1      }
 357          void Deal(void)
 358          {
 359   1              unsigned long Dis = 0;
 360   1              Dis = Distance();
 361   1              DisplayLCD1602(Dis);
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 7   

 362   1      
 363   1          if(S <= 300 || hongwai == 1)//µ±Óöµ½ÕÏ°­ÎïÊ±
 364   1          {
 365   2      
 366   2                      Stop(1);//Í£ÏÂÀ´×ö²â¾à
 367   2                      
 368   2                      SEH_count = 20;         //0.5mS + ¶¨Ê±Æ÷Ê±¼ä  SEH_COUNT: 0£º0.5ms*0(0.1*0T)->0¡ã£¨Îó²îµ÷ÕûÎª3£© £¬10:0.5+1£¨0.1
             -*10T£©=1.5ms->90¡ã£¬ 20:0.5+2ms£¨0.1*20T£©=2.5ms->180¡ã
 369   2                      delay(500); //µÈ´ý¶æ»úµ½Î»
 370   2                      Dis = Distance();
 371   2                      DisplayLCD1602(Dis);            
 372   2                      LeftDistance = Dis;
 373   2                      delay(100);
 374   2                
 375   2               
 376   2                      SEH_count = 3;          //0.5mS + ¶¨Ê±Æ÷Ê±¼ä  SEH_COUNT: 0£º0.5ms*0(0.1*0T)->0¡ã£¨Îó²îµ÷ÕûÎª3£© £¬10:0.5+1£¨0.1*
             -10T£©=1.5ms->90¡ã£¬ 20:0.5+2ms£¨0.1*20T£©=2.5ms->180¡ã
 377   2                      delay(500); //µÈ´ý¶æ»úµ½Î»
 378   2                      Dis = Distance();
 379   2                      DisplayLCD1602(Dis);                    
 380   2                      RightDistance = Dis;
 381   2                      delay(100);
 382   2      
 383   2                      SEH_count = 10;         //0.5mS + ¶¨Ê±Æ÷Ê±¼ä  SEH_COUNT: 0£º0.5ms*0(0.1*0T)->0¡ã£¨Îó²îµ÷ÕûÎª3£© £¬10:0.5+1£¨0.1
             -*10T£©=1.5ms->90¡ã£¬ 20:0.5+2ms£¨0.1*20T£©=2.5ms->180¡ã
 384   2                      delay(500); //µÈ´ý¶æ»úµ½Î»
 385   2                      
 386   2                      back(20);
 387   2                      Stop(1);//Í£ÏÂÀ´×ö²â¾à
 388   2                      if((LeftDistance < 220 ) &&( RightDistance < 220 ))//µ±×óÓÒÁ½²à¾ùÓÐÕÏ°­Îï¿¿µÃ±È½Ï½ü
 389   2                              Turn_Left(300);//Ðý×ªµôÍ·
 390   2                      else if(LeftDistance > RightDistance)//×ó±ß±ÈÓÒ±ß¿Õ¿õ
 391   2                      {      
 392   3                              Turn_Left(150);//×ó×ª
 393   3                              Stop(50);//É²³µ£¬ÎÈ¶¨·½Ïò
 394   3                      }
 395   2                      else//ÓÒ±ß±È×ó±ß¿Õ¿õ
 396   2                      {
 397   3                              Turn_Right(150);//×ó×ª
 398   3                              Stop(50);//É²³µ£¬ÎÈ¶¨·½Ïò
 399   3                      }
 400   2          }
 401   1          else if(S > 300 && hongwai == 0)//µ±Óöµ½ÕÏ°­ÎïÊ±
 402   1          {
 403   2                      Forward(0); //ÎÞÕÏ°­Îï£¬Ö±ÐÐ     
 404   2          }
 405   1      
 406   1               
 407   1      }
 408          
 409          /********************************************************/
 410          void zd0() interrupt 3           //T0ÖÐ¶ÏÓÃÀ´¼ÆÊýÆ÷Òç³ö,³¬¹ý²â¾à·¶Î§
 411          {
 412   1          flag=1;                      //ÖÐ¶ÏÒç³ö±êÖ¾
 413   1              RX=0;
 414   1      }
 415          
 416          /********************************************************/
 417          void keyscan(void)              //°´¼üÉ¨Ãèº¯Êý
 418          {
 419   1          A:    if(K4==0)                     //ÅÐ¶ÏÊÇ·ñÓÐ°´ÏÂÐÅºÅ
 420   1                      {
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 8   

 421   2                          delay(10);            //ÑÓÊ±10ms
 422   2                              if(K4==0)                       //ÔÙ´ÎÅÐ¶ÏÊÇ·ñ°´ÏÂ
 423   2                               {
 424   3                                  FM=0;               //·äÃùÆ÷Ïì              
 425   3                                  while(K4==0);       //ÅÐ¶ÏÊÇ·ñËÉ¿ª°´¼ü
 426   3                                  FM=1;               //·äÃùÆ÷Í£Ö¹  
 427   3                               }
 428   2                          else
 429   2                           {
 430   3                             goto A;        //Ìø×ªµ½AÖØÐÂ¼ì²â
 431   3                            }
 432   2                      }
 433   1                      else
 434   1                      {
 435   2                        goto A;             //Ìø×ªµ½AÖØÐÂ¼ì²â
 436   2                      }
 437   1      }
 438          /*µ÷½Úpush_val_leftµÄÖµ¸Ä±äµç»ú×ªËÙ,Õ¼¿Õ±È*/
 439          void pwm_out_left_moto(void)
 440          {  
 441   1           if(Left_PWM_ON)
 442   1           {
 443   2                if(pwm_val_left<=push_val_left)
 444   2                    {
 445   3                         EN1=1; 
 446   3                    }
 447   2                    else 
 448   2                    {
 449   3                         EN1=0;
 450   3                }
 451   2                if(pwm_val_left>=20)
 452   2                    pwm_val_left=0;
 453   2           }
 454   1           else    
 455   1           {
 456   2                EN1=0;   //ÈôÎ´¿ªÆôPWMÔòEN1=0 ×óµç»ú Í£Ö¹
 457   2           }
 458   1      }
 459          /******************************************************************/
 460          /*                    ÓÒµç»úµ÷ËÙ                                  */  
 461          void pwm_out_right_moto(void)
 462          { 
 463   1          if(Right_PWM_ON)
 464   1          { 
 465   2              if(pwm_val_right<=push_val_right)       //20msÄÚµçÆ½ÐÅºÅ 111 111 0000 0000 0000 00
 466   2                  {
 467   3                      EN2=1;                                                  //Õ¼¿Õ±È6:20
 468   3              }
 469   2                  else 
 470   2                  {
 471   3                      EN2=0;
 472   3              }
 473   2                  if(pwm_val_right>=20)
 474   2                  pwm_val_right=0;
 475   2          }
 476   1          else    
 477   1          {
 478   2              EN2=0;    //ÈôÎ´¿ªÆôPWMÔòEN2=0 ÓÒµç»ú Í£Ö¹
 479   2          }
 480   1      } 
 481          /********************************************************/ 
 482           /*¶æ»ú¿ØÖÆ*/
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 9   

 483          void InitPWMTimer(void)
 484          {
 485   1              TMOD |= 0x01;//¿ª¶¨Ê±Æ÷0
 486   1              TH0 = 0xff;   //ÅäÖÃ¶¨Ê±Æ÷0³õÖµ£¬Òç³öÊ±¼äÎª0.1ms
 487   1          TL0 = 0xa3;
 488   1              
 489   1              EA=1;//¿ª×Ü¶Ï
 490   1              TR0=1;//¿ª¶¨Ê±Æ÷0
 491   1              ET0=1;
 492   1      }
 493          
 494          void timer0(void) interrupt 1//¶¨Ê±Æ÷0ÖÐ¶Ïº¯Êý
 495          {
 496   1              TR0 = 0;      //¹Ø±Õ¶¨Ê±Æ÷0
 497   1          TH0 = 0xff;   //ÖØ×°³õÖµ0.1ms
 498   1          TL0 = 0xa3;
 499   1          //¶æ»ú1
 500   1          if(count <= SEH_count) //¿ØÖÆÕ¼¿Õ±È×óÓÒ
 501   1          {
 502   2              //Èç¹ûcountµÄ¼ÆÊýÐ¡ÓÚ£¨5-25£©Ò²¾ÍÊÇ0.5ms-2.5msÔòÕâ¶ÎÐ¡tÖÜÆÚ³ÖÐø¸ßµçÆ½¡£²úÉú·½²¨
 503   2              pwm = 1;
 504   2          }
 505   1          else
 506   1          {
 507   2              pwm = 0;
 508   2                      //TR0 = 0; //¹Ø¶¨Ê±Æ÷0
 509   2          }
 510   1      
 511   1              count++;
 512   1              pwmcount++;
 513   1          if (count >= 200) //T = 20msÔò¶¨Ê±Æ÷¼ÆÊý±äÁ¿Çå0
 514   1          {
 515   2              count = 0;
 516   2          }
 517   1              if(pwmcount >= 10)
 518   1              {
 519   2                      pwm_val_left++;
 520   2                      pwm_val_right++;
 521   2                      pwm_out_left_moto();
 522   2                      pwm_out_right_moto();
 523   2                      pwmcount = 0;
 524   2              }
 525   1      
 526   1          TR0 = 1; //¿ªÆô¶¨Ê±Æ÷0
 527   1      }
 528          
 529          /*¶æ»ú¿ØÖÆ*/
 530          /*************Ö÷³ÌÐò********************/
 531          void main(void)
 532          {
 533   1              cmg88();//¹ØÊýÂë¹Ü
 534   1              delay(400); //Æô¶¯µÈ´ý£¬µÈLCM½²Èë¹¤×÷×´Ì¬
 535   1              LCMInit(); //LCM³õÊ¼»¯
 536   1              delay(5);//ÑÓÊ±Æ¬¿Ì
 537   1      
 538   1              DisplayListChar(0, 0, Range);
 539   1              DisplayListChar(0, 1, table);
 540   1          
 541   1              TMOD=TMOD|0x10;//ÉèT1Îª·½Ê½1£¬GATE=1£»
 542   1          EA=1;                                          //¿ªÆô×ÜÖÐ¶Ï
 543   1          TH1=0;
 544   1          TL1=0;          
C51 COMPILER V8.06   MAIN                                                                  05/17/2017 21:59:04 PAGE 10  

 545   1          ET1=1;             //ÔÊÐíT1ÖÐ¶Ï
 546   1          
 547   1              SEH_count = 10;
 548   1      
 549   1              InitPWMTimer();  //³õÊ¼»¯¶æ»úPWM
 550   1              //=======================================================================================================
             -================                      
 551   1              keyscan() ;  //°´¼üÉ¨Ãè
 552   1              while(1)
 553   1              {
 554   2                      
 555   2                  //ÅÐ¶ÏºìÍâ±ÜÕÏÊÇ·ñ´¥·¢
 556   2                  if(Left_2_led==0 || Right_2_led==0)
 557   2                      {
 558   3                              Stop(1);//É²³µ£¬ÎÈ¶¨·½Ïò
 559   3                              hongwai = 1;    
 560   3                      }
 561   2                      else
 562   2                      {
 563   3                              hongwai = 0;
 564   3                      }
 565   2      
 566   2                      Deal();
 567   2          
 568   2              }
 569   1      
 570   1      } 
 571          
 572          
 573          
 574                                      


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1608    ----
   CONSTANT SIZE    =     64    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     43      29
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
